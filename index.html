<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />
        <title>Freed</title>
        <meta name="theme-color" content="#f8f9fa" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta
            name="apple-mobile-web-app-status-bar-style"
            content="black-translucent"
        />
        <link rel="manifest" href="./manifest.json" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=JetBrains+Mono:wght@400&display=swap"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="./styles.css" />
        <script src="https://unpkg.com/@mozilla/readability@0.5.0/Readability.js"></script>
        <script type="importmap">
            {
                "imports": {
                    "@google/genai": "https://esm.run/@google/genai"
                }
            }
        </script>
    </head>
    <body>
        <!-- Sidebar -->
        <aside id="sidebar">
            <div class="brand">
                <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <path
                        d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"
                    />
                    <path
                        d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"
                    />
                </svg>
                Freed
            </div>

            <div class="sidebar-scroll">
                <div class="nav-item" data-id="discover">
                    <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <circle cx="12" cy="12" r="10"></circle>
                        <polygon
                            points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"
                        ></polygon>
                    </svg>
                    Discover
                </div>

                <div class="nav-item active" data-id="all">
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    All Articles
                </div>

                <div class="feed-section-header">
                    <span class="feed-list-title-text">My Feeds</span>
                    <button
                        id="btn-new-feed"
                        class="btn-icon-add"
                        title="Add New Feed"
                    >
                        <svg
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                        >
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </div>

                <div id="feed-list-container">
                    <!-- JS will inject feeds here -->
                </div>

                <!-- Plugin Slots for Sidebar -->
                <div id="plugin-sidebar-container"></div>
            </div>

            <div class="sidebar-footer">
                <div class="nav-item" id="btn-settings">
                    <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
                        ></path>
                    </svg>
                    Settings
                </div>
            </div>
        </aside>

        <!-- Sidebar Backdrop -->
        <div id="sidebar-backdrop" class="sidebar-backdrop"></div>

        <!-- Main Content -->
        <main id="main">
            <header>
                <button class="mobile-menu-btn" id="menu-btn">
                    <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <div class="header-title" id="page-title">All Articles</div>
                <button
                    class="mobile-filter-btn"
                    id="btn-toggle-filters"
                    aria-label="Toggle Filters"
                >
                    <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <polygon
                            points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"
                        ></polygon>
                    </svg>
                </button>
            </header>

            <div id="filter-bar" class="filter-bar">
                <div class="filter-group">
                    <div class="search-wrapper">
                        <svg
                            width="16"
                            height="16"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            class="search-icon"
                        >
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input
                            type="text"
                            id="filter-search"
                            class="filter-input"
                            placeholder="Search..."
                        />
                    </div>

                    <select id="filter-status" class="filter-select">
                        <option value="all">All Status</option>
                        <option value="unread">Unread</option>
                        <option value="unfinished">Unfinished</option>
                        <option value="favorites">Favorites</option>
                        <option value="read">Read</option>
                        <option value="discarded">Discarded</option>
                    </select>
                    <select id="filter-date" class="filter-select">
                        <option value="all">Anytime</option>
                        <option value="24h">Past 24 Hours</option>
                        <option value="7d">Past 7 Days</option>
                    </select>

                    <!-- Tag Filter Input -->
                    <div class="filter-tag-wrapper">
                        <div
                            id="filter-active-tags"
                            class="filter-tags-list"
                        ></div>
                        <input
                            type="text"
                            id="filter-tag-input"
                            placeholder="+ Tag"
                            class="filter-input-tag"
                            autocomplete="off"
                        />
                    </div>

                    <button
                        id="btn-clear-filters"
                        class="btn-text"
                        style="display: none"
                    >
                        Clear
                    </button>
                </div>
            </div>

            <div id="article-list">
                <!-- Articles go here -->
            </div>
        </main>

        <!-- Reader Modal -->
        <div class="modal-backdrop" id="read-modal">
            <div class="modal reader-modal">
                <div class="modal-header">
                    <div
                        style="
                            font-weight: 600;
                            font-size: 0.9rem;
                            color: var(--text-muted);
                        "
                    >
                        Reading View
                    </div>
                    <div style="display: flex; gap: 12px; align-items: center">
                        <a
                            href="#"
                            target="_blank"
                            id="btn-visit-website"
                            class="icon-btn"
                            title="Visit Website"
                        >
                            <svg
                                width="20"
                                height="20"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <path
                                    d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"
                                ></path>
                                <polyline points="15 3 21 3 21 9"></polyline>
                                <line x1="10" y1="14" x2="21" y2="3"></line>
                            </svg>
                        </a>
                        <button
                            class="icon-btn"
                            id="btn-toggle-favorite"
                            title="Toggle Favorite"
                        >
                            <svg
                                width="20"
                                height="20"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <polygon
                                    points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"
                                ></polygon>
                            </svg>
                        </button>
                        <button
                            class="icon-btn"
                            id="btn-share-article"
                            title="Share Article"
                        >
                            <svg
                                width="20"
                                height="20"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                            >
                                <circle cx="18" cy="5" r="3"></circle>
                                <circle cx="6" cy="12" r="3"></circle>
                                <circle cx="18" cy="19" r="3"></circle>
                                <line
                                    x1="8.59"
                                    y1="13.51"
                                    x2="15.42"
                                    y2="17.49"
                                ></line>
                                <line
                                    x1="15.41"
                                    y1="6.51"
                                    x2="8.59"
                                    y2="10.49"
                                ></line>
                            </svg>
                        </button>
                        <div
                            style="
                                width: 1px;
                                height: 16px;
                                background: var(--border);
                                margin: 0 4px;
                            "
                        ></div>
                        <button class="close-btn" onclick="window.closeModal()">
                            <svg
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                            >
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="reader-scroll-container">
                    <div id="reader-hero" class="reader-hero"></div>

                    <div class="reader-header-content">
                        <div class="reader-meta-row">
                            <span id="reader-feed-title">Feed Source</span>
                            <span style="color: var(--border)">|</span>
                            <span id="reader-date" class="reader-meta-date"
                                >Date</span
                            >
                        </div>
                        <h1 id="reader-title" class="reader-title">
                            Article Title
                        </h1>
                    </div>

                    <div id="reader-content" class="article-content">
                        <!-- Article Content Injected Here -->
                    </div>

                    <div class="reader-footer">
                        <!-- Footer spacer or additional controls if needed later -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Global Tooltip -->
        <div id="global-tooltip" class="global-tooltip"></div>

        <!-- Tag Color Popup -->
        <div id="tag-color-popup" class="tag-color-popup" style="display: none">
            <div id="tag-color-popup-swatches" class="color-picker-row"></div>
        </div>

        <!-- Global Autocomplete Dropdown -->
        <div id="global-autocomplete" class="autocomplete-suggestions"></div>

        <!-- Selection Toolbar -->
        <div
            id="selection-toolbar"
            class="selection-toolbar"
            style="display: none"
        >
            <!-- Core Buttons -->
            <button id="btn-tool-highlight">
                <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                >
                    <path d="M9 11l-6 6v3h9l3-3"></path>
                    <path
                        d="m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4"
                    ></path>
                </svg>
                Highlight
            </button>
            <button id="btn-tool-clear" style="display: none">
                <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                >
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path
                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                    ></path>
                    <line x1="10" y1="11" x2="10" y2="17"></line>
                    <line x1="14" y1="11" x2="14" y2="17"></line>
                </svg>
                Clear
            </button>
            <!-- Divider for Plugins -->
            <div
                class="divider"
                id="toolbar-divider"
                style="display: none"
            ></div>
            <!-- Plugin buttons injected here -->
            <div
                id="plugin-tools-container"
                style="display: flex; gap: 4px"
            ></div>
        </div>

        <!-- Feed Modal (Add/Edit) -->
        <div class="modal-backdrop" id="feed-modal">
            <div class="modal">
                <div class="modal-header">
                    <h3 style="margin: 0" id="feed-modal-title">
                        Add New Feed
                    </h3>
                    <button class="close-btn" onclick="window.closeFeedModal()">
                        <svg
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <div class="modal-content">
                    <input type="hidden" id="feed-id-input" />

                    <label
                        style="
                            font-size: 0.85rem;
                            font-weight: 600;
                            color: var(--text-muted);
                            display: block;
                            margin-bottom: 6px;
                        "
                        >Feed URL</label
                    >
                    <input
                        type="url"
                        id="feed-url-input"
                        placeholder="https://example.com/rss"
                        style="width: 100%; margin-bottom: 16px"
                    />

                    <label
                        style="
                            font-size: 0.85rem;
                            font-weight: 600;
                            color: var(--text-muted);
                            display: block;
                            margin-bottom: 6px;
                        "
                        >Feed Name</label
                    >
                    <input
                        type="text"
                        id="feed-name-input"
                        placeholder="e.g. Tech News (Optional)"
                        style="width: 100%; margin-bottom: 16px"
                    />

                    <div
                        style="
                            display: flex;
                            align-items: center;
                            justify-content: space-between;
                            margin-bottom: 16px;
                        "
                    >
                        <div
                            style="display: flex; align-items: center; gap: 8px"
                        >
                            <label
                                style="
                                    font-size: 0.85rem;
                                    font-weight: 600;
                                    color: var(--text-muted);
                                    margin: 0;
                                "
                                for="feed-use-icon-input"
                                >Use website icon</label
                            >
                            <img
                                id="feed-icon-preview"
                                style="
                                    width: 20px;
                                    height: 20px;
                                    border-radius: 4px;
                                    object-fit: contain;
                                    display: none;
                                    background: #f3f4f6;
                                "
                                alt="Icon Preview"
                            />
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="feed-use-icon-input" />
                            <span class="slider"></span>
                        </label>
                    </div>

                    <label
                        style="
                            font-size: 0.85rem;
                            font-weight: 600;
                            color: var(--text-muted);
                            display: block;
                            margin-bottom: 6px;
                        "
                        >Tags</label
                    >
                    <div style="margin-bottom: 16px">
                        <div id="feed-tags-list" class="tags-container"></div>
                        <div class="tag-input-wrapper">
                            <input
                                type="text"
                                id="feed-tags-input"
                                placeholder="Add a tag..."
                                style="width: 100%; margin-top: 8px"
                                autocomplete="off"
                            />
                        </div>
                    </div>

                    <div
                        style="
                            display: flex;
                            align-items: center;
                            justify-content: space-between;
                            margin-bottom: 16px;
                        "
                    >
                        <label
                            style="
                                font-size: 0.85rem;
                                font-weight: 600;
                                color: var(--text-muted);
                            "
                            for="feed-autofetch-input"
                            >Autofetch Full Content</label
                        >
                        <label class="toggle-switch">
                            <input type="checkbox" id="feed-autofetch-input" />
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div
                        style="
                            font-size: 0.8rem;
                            color: var(--text-muted);
                            margin-top: -12px;
                            margin-bottom: 16px;
                        "
                    >
                        Automatically downloads full article text in the
                        background.
                    </div>

                    <label
                        style="
                            font-size: 0.85rem;
                            font-weight: 600;
                            color: var(--text-muted);
                            display: block;
                            margin-bottom: 8px;
                        "
                        >Feed Accent Color</label
                    >
                    <div id="color-picker-container" class="color-picker-row">
                        <!-- JS injects colors here -->
                    </div>
                </div>
                <div
                    class="modal-actions"
                    style="justify-content: space-between"
                >
                    <button
                        class="btn btn-outline"
                        id="btn-delete-feed"
                        style="
                            border-color: #ef4444;
                            color: #ef4444;
                            display: none;
                        "
                    >
                        Delete
                    </button>
                    <div
                        id="feed-modal-action-buttons"
                        style="display: flex; gap: 8px; margin-left: auto"
                    >
                        <button
                            class="btn btn-outline"
                            onclick="window.closeFeedModal()"
                        >
                            Cancel
                        </button>
                        <button class="btn btn-primary" id="btn-save-feed">
                            Save
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Modal -->
        <div class="modal-backdrop" id="stats-modal">
            <div class="modal">
                <div class="modal-header">
                    <h3 style="margin: 0" id="stats-modal-title">Feed Stats</h3>
                    <button
                        class="close-btn"
                        onclick="window.closeStatsModal()"
                    >
                        <svg
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <div class="modal-content" id="stats-modal-content">
                    <!-- Injected via JS -->
                </div>
                <div class="modal-actions" style="justify-content: flex-end">
                    <button
                        class="btn btn-primary"
                        onclick="window.closeStatsModal()"
                    >
                        Close
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="modal-backdrop" id="settings-modal">
            <div class="modal">
                <div class="modal-header">
                    <h3 style="margin: 0">Settings</h3>
                    <button
                        class="close-btn"
                        onclick="window.closeSettingsModal()"
                    >
                        <svg
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>

                <!-- Tabs Header -->
                <div class="settings-tabs-header">
                    <button
                        class="settings-tab-btn active"
                        data-target="tab-appearance"
                    >
                        Appearance
                    </button>
                    <button class="settings-tab-btn" data-target="tab-general">
                        General
                    </button>
                    <button class="settings-tab-btn" data-target="tab-data">
                        Data
                    </button>
                    <button class="settings-tab-btn" data-target="tab-plugins">
                        Plugins
                    </button>
                </div>

                <div class="modal-content settings-tab-content-container">
                    <!-- Tab: Appearance -->
                    <div id="tab-appearance" class="settings-tab-pane active">
                        <label
                            style="
                                font-size: 0.85rem;
                                font-weight: 600;
                                color: var(--text-muted);
                                display: block;
                                margin-bottom: 6px;
                            "
                            >App Theme</label
                        >
                        <select
                            id="settings-theme"
                            style="width: 100%; margin-bottom: 16px"
                        >
                            <option value="system">System Default</option>
                            <option value="light">Light</option>
                            <option value="dark">Dark (Gray)</option>
                            <option value="midnight">Midnight (OLED)</option>
                            <option value="sepia">Sepia (Paper)</option>
                            <option value="ocean">Ocean (Blue)</option>
                            <option value="forest">Forest (Green)</option>
                            <option value="sunset">Sunset (Warm)</option>
                            <option value="terminal">Terminal (Hacker)</option>
                        </select>

                        <label
                            style="
                                font-size: 0.85rem;
                                font-weight: 600;
                                color: var(--text-muted);
                                display: block;
                                margin-bottom: 6px;
                            "
                            >App Font</label
                        >
                        <select
                            id="settings-font"
                            style="width: 100%; margin-bottom: 16px"
                        >
                            <option value="system">System UI</option>
                            <option value="inter">Inter (Default)</option>
                            <option value="serif">Merriweather (Serif)</option>
                            <option value="mono">JetBrains Mono</option>
                            <option value="helvetica">Helvetica</option>
                            <option value="georgia">Georgia</option>
                        </select>

                        <div
                            style="
                                display: flex;
                                align-items: center;
                                justify-content: space-between;
                                margin-bottom: 16px;
                            "
                        >
                            <label
                                style="
                                    font-size: 0.85rem;
                                    font-weight: 600;
                                    color: var(--text-muted);
                                "
                                for="settings-show-images"
                                >Show Featured Images</label
                            >
                            <label class="toggle-switch">
                                <input
                                    type="checkbox"
                                    id="settings-show-images"
                                />
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Tab: General -->
                    <div id="tab-general" class="settings-tab-pane">
                        <!-- Plugin settings will be injected here -->
                        <div id="plugin-settings-container-general"></div>

                        <div
                            style="
                                height: 1px;
                                background: var(--border);
                                margin: 0 0 24px;
                            "
                        ></div>

                        <h4 style="margin-bottom: 10px">Gemini API Key</h4>
                        <p
                            style="
                                margin-top: 0;
                                font-size: 0.9rem;
                                color: var(--text-muted);
                            "
                        >
                            Required if using Gemini for parsing complex feeds.
                        </p>
                        <input
                            type="password"
                            id="settings-api-key"
                            placeholder="Enter your Gemini API Key"
                            style="width: 100%; margin-bottom: 8px"
                        />
                        <p style="font-size: 0.8rem; margin: 0">
                            <a
                                href="https://aistudio.google.com/app/apikey"
                                target="_blank"
                                style="color: var(--primary)"
                                >Get an API key here</a
                            >
                        </p>
                    </div>

                    <!-- Tab: Data -->
                    <div id="tab-data" class="settings-tab-pane">
                        <h4 style="margin-top: 0; margin-bottom: 10px">
                            Import / Export (OPML)
                        </h4>

                        <div
                            style="
                                background: var(--bg-body);
                                padding: 12px;
                                border-radius: 8px;
                                border: 1px solid var(--border);
                            "
                        >
                            <div
                                style="
                                    margin-bottom: 12px;
                                    font-weight: 600;
                                    font-size: 0.85rem;
                                    color: var(--text-muted);
                                "
                            >
                                Export Options
                            </div>
                            <label
                                style="
                                    display: flex;
                                    gap: 8px;
                                    margin-bottom: 8px;
                                    font-size: 0.9rem;
                                "
                            >
                                <input
                                    type="checkbox"
                                    id="export-feeds"
                                    checked
                                />
                                Feeds & Parsing Rules
                            </label>
                            <label
                                style="
                                    display: flex;
                                    gap: 8px;
                                    margin-bottom: 8px;
                                    font-size: 0.9rem;
                                "
                            >
                                <input
                                    type="checkbox"
                                    id="export-settings"
                                    checked
                                />
                                App Settings
                            </label>
                            <label
                                style="
                                    display: flex;
                                    gap: 8px;
                                    margin-bottom: 12px;
                                    font-size: 0.9rem;
                                "
                            >
                                <input
                                    type="checkbox"
                                    id="export-favorites"
                                    checked
                                />
                                Favorites & Saved Content
                            </label>
                            <button
                                id="btn-export-opml"
                                class="btn btn-primary"
                                style="width: 100%; justify-content: center"
                            >
                                Download Backup (OPML)
                            </button>

                            <div
                                style="
                                    height: 1px;
                                    background: var(--border);
                                    margin: 16px 0;
                                "
                            ></div>

                            <div
                                style="
                                    margin-bottom: 12px;
                                    font-weight: 600;
                                    font-size: 0.85rem;
                                    color: var(--text-muted);
                                "
                            >
                                Import Options
                            </div>
                            <label
                                style="
                                    display: flex;
                                    gap: 8px;
                                    margin-bottom: 8px;
                                    font-size: 0.9rem;
                                "
                            >
                                <input
                                    type="checkbox"
                                    id="import-feeds"
                                    checked
                                />
                                Feeds & Parsing Rules
                            </label>
                            <label
                                style="
                                    display: flex;
                                    gap: 8px;
                                    margin-bottom: 8px;
                                    font-size: 0.9rem;
                                "
                            >
                                <input
                                    type="checkbox"
                                    id="import-settings"
                                    checked
                                />
                                App Settings
                            </label>
                            <label
                                style="
                                    display: flex;
                                    gap: 8px;
                                    margin-bottom: 8px;
                                    font-size: 0.9rem;
                                "
                            >
                                <input
                                    type="checkbox"
                                    id="import-favorites"
                                    checked
                                />
                                Favorites & Saved Content
                            </label>
                            <label
                                style="
                                    display: flex;
                                    gap: 8px;
                                    margin-bottom: 12px;
                                    font-size: 0.9rem;
                                "
                            >
                                <input type="checkbox" id="import-overwrite" />
                                Overwrite existing items
                            </label>
                            <input
                                type="file"
                                id="file-input-import"
                                style="display: none"
                                accept=".opml,.xml"
                            />
                            <button
                                id="btn-import-opml"
                                class="btn btn-outline"
                                style="
                                    width: 100%;
                                    justify-content: center;
                                    background: var(--bg-card);
                                "
                            >
                                Import Backup (OPML)
                            </button>
                        </div>

                        <div
                            style="
                                height: 1px;
                                background: var(--border);
                                margin: 24px 0;
                            "
                        ></div>

                        <h4 style="margin-bottom: 10px">Data Retention</h4>
                        <p
                            style="
                                margin-top: 0;
                                font-size: 0.9rem;
                                color: var(--text-muted);
                                margin-bottom: 12px;
                            "
                        >
                            Favorites are never deleted. Policies run on app
                            launch.
                        </p>

                        <label
                            style="
                                font-size: 0.85rem;
                                font-weight: 600;
                                color: var(--text-muted);
                                display: block;
                                margin-bottom: 6px;
                            "
                            >Delete unread articles older than (days)</label
                        >
                        <input
                            type="number"
                            id="settings-cleanup-unread"
                            min="1"
                            style="width: 100%; margin-bottom: 12px"
                        />

                        <label
                            style="
                                font-size: 0.85rem;
                                font-weight: 600;
                                color: var(--text-muted);
                                display: block;
                                margin-bottom: 6px;
                            "
                            >Remove article body text older than (days)</label
                        >
                        <input
                            type="number"
                            id="settings-cleanup-content"
                            min="1"
                            style="width: 100%; margin-bottom: 12px"
                        />

                        <label
                            style="
                                font-size: 0.85rem;
                                font-weight: 600;
                                color: var(--text-muted);
                                display: block;
                                margin-bottom: 16px;
                            "
                            >Delete read articles older than (days)</label
                        >
                        <input
                            type="number"
                            id="settings-cleanup-read"
                            min="1"
                            style="width: 100%; margin-bottom: 16px"
                        />
                    </div>

                    <!-- Tab: Plugins -->
                    <div id="tab-plugins" class="settings-tab-pane">
                        <h4 style="margin-top: 0; margin-bottom: 10px">
                            Install Plugin
                        </h4>
                        <div
                            style="display: flex; gap: 8px; margin-bottom: 20px"
                        >
                            <input
                                type="url"
                                id="plugin-install-url"
                                placeholder="https://example.com/manifest.json"
                                style="flex: 1"
                            />
                            <button
                                id="btn-install-plugin"
                                class="btn btn-primary"
                            >
                                Install
                            </button>
                        </div>

                        <div
                            style="
                                height: 1px;
                                background: var(--border);
                                margin: 20px 0;
                            "
                        ></div>

                        <h4 style="margin-bottom: 10px">Installed Plugins</h4>
                        <div id="plugins-list-container">
                            <!-- Injected JS -->
                        </div>
                    </div>
                </div>
                <div class="modal-actions" style="justify-content: flex-end">
                    <button class="btn btn-primary" id="btn-save-settings">
                        Save Settings
                    </button>
                </div>
            </div>
        </div>

        <div id="toast" class="toast"></div>

        <!-- Dependencies loaded sequentially -->
        <script src="./js/config.js"></script>
        <script src="./js/state.js"></script>
        <script src="./js/utils.js"></script>
        <script src="./js/db.js"></script>
        <script src="./js/theme.js"></script>
        <script src="./js/ai-service.js"></script>
        <script src="./js/rss-service.js"></script>
        <script src="./js/data-service.js"></script>
        <script src="./js/plugin-system/registry.js"></script>
        <script src="./js/plugin-system/interface.js"></script>
        <script src="./js/plugin-system/manager.js"></script>
        <script src="./js/ui-renderer.js"></script>
        <script src="./js/tools.js"></script>
        <script src="./js/tags.js"></script>
        <script src="./js/reader.js"></script>
        <script src="./js/feeds.js"></script>
        <script src="./js/discover-data.js"></script>
        <script src="./js/app.js"></script>
    </body>
</html>
